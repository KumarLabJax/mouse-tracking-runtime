// Example configuration for the classifier bootstrap pipeline.
// Update the paths and classifiers to match your environment before running.

params {
    // Root directory where classifier artifacts will be written.
    classifier_base_path = "/projects/kumar-lab/data/classifiers"

    // Directory containing source JABS project folders referenced below.
    classifier_project_folders = "/projects/kumar-lab/projects"

    // Version label for this bootstrap build.
    jabs_version = "v0.36.1"

    // Map of behaviors to their source projects and metadata.
    single_mouse_classifiers = [
        "grooming": [
            "project_folder_name": "grooming",
            "stitch_value": 10*30,
            "filter_value": 3*30,
        ],
        "scratch": [
            "project_folder_name": "jabs-paper",
            "stitch_value": 5,
            "filter_value": 5,
        ],
        // "Leg_splaying": [  // Currently can't be exported successfully
        //     "project_folder_name": "ptz",
        //     "stitch_value": 5,
        //     "filter_value": 5,
        // ],
        "Side seizure": [
            "project_folder_name": "ptz",
            "stitch_value": 5,
            "filter_value": 5,
        ],
        "Tail_jerk": [
            "project_folder_name": "ptz",
            "stitch_value": 5,
            "filter_value": 5,
        ],
        "Wild_jumping": [
            "project_folder_name": "ptz",
            "stitch_value": 5,
            "filter_value": 5,
        ],
        "Escape": [
            "project_folder_name": "jabs-vivek",
            "stitch_value": 5,
            "filter_value": 5,
        ],
        "Rearing_supported": [
            "project_folder_name": "jabs-vivek",
            "stitch_value": 5,
            "filter_value": 5,
        ],
        "Rearing_unsupported": [
            "project_folder_name": "jabs-vivek",
            "stitch_value": 5,
            "filter_value": 5,
        ],
        "Turn_left": [
            "project_folder_name": "jabs-vivek",
            "stitch_value": 5,
            "filter_value": 5,
        ],
        "Turn_right": [
            "project_folder_name": "jabs-vivek",
            "stitch_value": 5,
            "filter_value": 5,
        ],
    ]
}

apptainer {
   enabled = true
   autoMounts = true
}

process {
    withLabel: "jabs_classify" {
        container = "/projects/kumar-lab/meta/images/JABS-behavior-classifier/headless/v0.36.1/latest.sif"
    }

    withLabel: "cpu" {
        queue = "compute"
        resourceLimits = [ cpus: 1, memory: 24.GB, time: 24.h ]
    }
}

executor {
    name = 'slurm'
    // The number of tasks the executor will handle in a parallel manner
    queueSize = 24
    submitRateLimit = '1 s'
    // Determines the max rate of job submission per time unit, for example '10sec' eg. max 10 jobs per second or '1/2 s' i.e. 1 job submissions every 2 seconds.
}
